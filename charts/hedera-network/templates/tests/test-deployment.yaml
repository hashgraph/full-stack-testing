apiVersion: v1
kind: Pod
metadata:
  name: "network-test"
  annotations:
    "helm.sh/hook": test
    # add hook-failed once bug is fixed that prevents it from getting logs
    "helm.sh/hook-delete-policy": before-hook-creation
spec:
  serviceAccountName: pod-monitor
  volumes:
    - name: test-volume
      configMap:
        name: test-cm
        defaultMode: 0777 # we need the test files to be executable
  containers:
    - name: tester
      image: bitnami/kubectl:latest
      volumeMounts:
        - mountPath: /tests
          name: test-volume
      command:
        - "/bin/bash"
        - "-c"
        - /tests/run.sh
        #- "while true;do echo sleeping; sleep 10;done"
  restartPolicy: Never
